{% extends "base.html" %}
{% block content %}
<div class="modal fade hide" id="AddFile">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">Ã—</button>
        <h3>Add file</h3>
    </div>
    <div class="modal-body" id="AddFileBody">
        <form method="post" action="/add/" enctype="multipart/form-data">
            <fieldset>
                <label>Choose a file</label>
                <input type="file" name="file" />
                <br />
                <label>Password</label>
                <input type="password" name="password" />
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Upload</button>
                    <a href="javascript:void(0);" class="btn" data-dismiss="modal">Cancel</a>
                </div>
            </fieldset>
        </form>
    </div>
</div>
<div class="well">
    <button class="btn btn-primary" onclick="showAddFile();">Add files</button>
</div>
<h3>File list</h3>
<table class="table table-striped">
<thead><th>Name</th><th>Encrypted</th><th>Actions</th></thead>
<tbody>
{% for file in files %}
<tr><td><a href="/download/{{file.id}}/" onclick="return downloadFile(this,'{{file.id}}');">{{file.filename}}</a></td><td id="encrypted">{{file.encrypted}}</td><td><a href="/delete/{{file.id}}/" onclick="return confirm('Are you sure?')">Delete</a></td></tr>
{% endfor %}
</tbody>
</table>
{% endblock %}
{% block scripts %}
<script type="text/javascript">
function showAddFile(){
    $("#AddFile").modal("show");
}
function downloadFile(obj, file_id) {
    if($(obj).parents("tr").children("#encrypted").html() == "False"){
        return true;
    } else {
        $(obj).parents('tr').after('<tr id="passwordtr"><td colspan=3><form method="post" action="/download/'+file_id+'/" class="form-inline" name="passwordform">Password: <input type="password" name="password" /> <button class="btn btn-primary" onclick="return submitpassform(this);">Download</button> <button class="btn" onclick="deletepasstr();">Cancel</button></form></td></tr>');
        return false;
    }
}
function deletepasstr(){
    $("#passwordtr").remove();
    return false;
}
function submitpassform(obj){
    if (document.forms['passwordform']['password'].value == null || document.forms['passwordform']['password'].value == "") {
        alert('No password given'); 
        return false;
    }
    setTimeout(function(){$("#passwordtr").remove()},100);
    return true;
}
</script>
{% endblock %}
